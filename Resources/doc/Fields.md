# Fields

* [Configure Fields by Annotations](#configure-fields-by-annotations)
  - [@QAG\Field](#gaqfield)
  - [@QAG\HideInForm](#gaqhideinform)
  - [@QAG\HideInList](#gaqhideinlist)
  - [@QAG\Ignore](#gaqignore)
  - [@QAG\Sort](#gaqsort)
  - [@QAG\Crud](#gaqcrud)
* [Configure Fields by overriding controllers](#configure-fields-by-overriding-controllers)
* [Configure Fields by using Listeners](#configure-fields-by-using-listeners)
  
---

Fields are the metadata that represents how an entity is rendered. One field represents an entity's attributes, such as `name` for example.

## Configure Fields by Annotations

You can add annotations directly to an entity to configure how it's going to be parsed. This is the quickest way to customize a Crud, but has some limitations.

Let's take a look at an example, here's a simple `Category` entity:

```php

use Arkounay\Bundle\QuickAdminGeneratorBundle\Annotation as QAG;
use Doctrine\ORM\Mapping as ORM;

/**
 * @ORM\Entity()
 */
class Category
{

    /**
     * @ORM\Id()
     * @ORM\GeneratedValue()
     * @ORM\Column(type="integer")
     */
    private $id;

    /**
     * @ORM\Column(type="string", length=255)
     * @QAG\Field(label="Title")
     * @QAG\Sort(direction="asc")
     */
    private $name;

    /**
     * @ORM\OneToMany(targetEntity=News::class, mappedBy="category", cascade={"persist", "remove"})
     * @QAG\HideInList()
     */
    private $news;

    // constructor, getters, setters, etc
}
```

In this example: 
- The `$name` field will have a "Title" label instead of the autogenerated `Name`, through the `@QAG\Field(label="Title")` annotation.
- It will be also sorted by name, alphabetically. That is specified by the `@QAG\Sort(direction="asc")` annotation.
- The list will not show the number of news, as `@QAG\HideInList()` removes the attribute from the list.

You can import the QAG annotations with 
```php
use Arkounay\Bundle\QuickAdminGeneratorBundle\Annotation as QAG;
```

There are **9** annotations available:

- @QAG\Field
- @QAG\HideInForm
- @QAG\HideInList
- @QAG\Ignore
- @QAG\Sort
- @QAG\Crud *(class-level)*
- @QAG\Show (only in manual fetch mode)
- @QAG\ShowInList (only in manual fetch mode)
- @QAG\ShowInForm (only in manual fetch mode)


#### @QAG\Field
Allows you to configure a field. Has 6 attributes.
- `label` changes the label. Uses the variable's name by default.
- `twigName` changes the twig called to render the field in the listing. 
The twig filed needs to be located at `templates/bundles/ArkounayQuickAdminGeneratorBundle/crud/fields/_[twigName].html.twig`. Keep the underscore character `_` before the file's name. Inside a twig, you can use the variables `value` to get the field's value and  `entity` to get the full entity. For instance, this can be used to have a specific date format for an entity.
-  `sortable` defines whether or not the field can be sorted when clicking on it. By default, all fields are sortable except virtual fields and relations.
- `formClass` is an additional class that will be added to the form's field, when creating and editing. To add multiple classes, just add a space.
- `formType` is the Form Type that will be used when rendering the form. For example, if you have an email field, you can use `Symfony\Component\Form\Extension\Core\Type\EmailType` to quickly set the type to Email. Note that it should be used only for simple Types as you can't pass options. For anything more advanced, consider overriding the form through PHP.
-  `required` defines if the form's field is required when editing or creating. If not specified, will automatically try to guess it with doctrine's metadata.

#### @QAG\HideInForm
Allows you to hide a field in both creation and edition.

#### @QAG\HideInList
Allows you to hide a field in listing.

#### @QAG\Ignore
Allows you to completely ignore a field. It will not be parsed, and thus hidden from listing, creation, and edition.

#### @QAG\Sort
Allows you to sort by a specific field in listing by default.
Has 1 attribute, `direction`. 'asc' or 'desc', specifies the sorting order.
Only **one** field in an entity should have this annotation.

#### @QAG\Crud (class-level)
This field must be at the class level.
```php
/**
 * @ORM\Entity(repositoryClass=CategoryRepository::class)
 * @QAG\Crud(fetchMode=QAG\Crud::FETCH_MANUAL)
 */
class Category 
{
    // ...
}
```
Has 1 attribute, `fetchMode`.

By default, any property added in a doctrine class will be converted into a Field.
You can change that by specifying a manual Fetch Mode.
In manual mode, you'll have to add @QAG\Show, @QAG\ShowInList and @QAG\ShowInForm to make them appear, otherwise fields will be ignored.

#### @QAG\Show (only in manual fetch mode)
Will show the field both in listing, creation and edition.

#### @QAG\ShowInForm (only in manual fetch mode)
Will show the field both in creation and edition only

#### @QAG\ShowInList (only in manual fetch mode)
Will show the field both in listing only


## Configure Fields by overriding controllers
Another way to configure a field is by overriding the entity's crud controller that refers to this field.
This gives more control than annotations.
For example, in a Category crud controller, you can do this :

```php
namespace App\Controller\Admin;


use App\Entity\Category;
use Arkounay\Bundle\QuickAdminGeneratorBundle\Controller\Crud;
use Arkounay\Bundle\QuickAdminGeneratorBundle\Model\Fields;

class CategoryController extends Crud
{

    public function getEntity(): string
    {
        return Category::class;
    }

    protected function createFields(): Fields
    {
        return parent::createFields();
    }

    protected function getListingFields(): Fields
    {
        $fields = parent::getListingFields();
        $fields['id']->setSortable(false);

        return $fields
            ->remove('name')
            ->add('slug'); // adds a virtual field (if there is a getSlug() method)
    }

    protected function getFormFields(): Fields
    {
        $fields = parent::getFormFields();
        $fields['name']->setLabel("Please specify the name");

        return $fields;
    }

}
```

In this example:
- In listing mode, a new field will be created : 'slug'. This is a virtual field (Category has a `getSlug()` method). The 'name' field will be removed.
- In creation and edition, the field 'name' will have a special label.


## Configure Fields by using Listeners
It's also possible to configure fields using listener. This is useful if you wish to add special rules for fields that can be applied globally.
To do that, you have to listen at the `qag.events.field_generation` event.
The event's subject is the field.

Here's an example:
```php
namespace App\Listener\AdminForm;


use Arkounay\Bundle\QuickAdminGeneratorBundle\Model\Field;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;
use Symfony\Component\EventDispatcher\GenericEvent;

class FormPositionListener implements EventSubscriberInterface
{

    public static function getSubscribedEvents()
    {
        return [
            'qag.events.field_generation' => 'fieldGenerationEvent'
        ];
    }

    public function fieldGenerationEvent(GenericEvent $event): void
    {
        /** @var Field $field */
        $field = $event->getSubject();

        if (self::IsPosition($field)) {
            $field->setTwig('@ArkounayQuickAdminGenerator/crud/fields/_position.html.twig');
            $field->setSortable(true);
        }
    }

    private static function IsPosition(Field $field): bool
    {
        return $field->getIndex() === 'position' && $field->getType() === 'integer' ;
    }

}
``` 
Here, everytime an entity has a property named `position` with the type `integer`, it will use a special twig without any extra configuration per controllers or entities.